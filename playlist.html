<html>
	<head>
		<title>Discover</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="home.css">
	</head>
	<body>

		<div class="nav-bar">
			<h1>Discover</h1>
			<button class="btn btn-blue">Log out</button>
		</div>

		<div class="main-playlist-container">
			<div class="playlist-container">
				<div class="playlist-title">
					<h2>Here is you new playlist.</h2>
					<p class="playlist-desc"></p>
				</div>
			</div>
			<div class="featured-container">
				<h2>Tracks inspired from</h2>
				<ul class="featured-list" id="main-artists">
				</ul>

				<h2>Featured Artists</h2>
				<ul class="featured-list" id="featured-artists">
				</ul>
			</div>
		</div>
	</body>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="script.js"></script>
	<script>
		var user = JSON.parse(localStorage['user']);
		var genres = JSON.parse(localStorage['genres'])
		var final_genres = JSON.parse(localStorage['final_genres']);
		var playlist = JSON.parse(localStorage['playlist']);
		var artists = JSON.parse(localStorage['artists']);
		var playlist_artists = JSON.parse(localStorage['playlist_artists']);

		var playlist_frame = '<iframe class="playlist" src="https://open.spotify.com/embed?uri='+ playlist.uri +'&theme=white" frameborder="0" allowtransparency="true"></iframe>';

		$('.playlist-desc').append("<p>Your playlist contains songs from the following genres: <b>"+ final_genres.join(", ") +"</b></p>");
		$('.playlist-container').append(playlist_frame)

		for (artist in artists) {
			let img_src = artists[artist].images[2].url;
			let link = artists[artist].external_urls.spotify;

			$('#main-artists').append('<li class="featured"><img src="' + img_src + '" alt="'+ artist +'"><h3>'+ artist +'</h3></li>');
		}


		for (artist in playlist_artists) {
			let artist_id = playlist_artists[artist].id;

			$.ajax({
				url: 'https://api.spotify.com/v1/artists/' + artist_id,
				type: 'get',
				headers: {
					'Authorization': 'Bearer ' + access_token
				},
				success: function(response){
					console.log(response);
					let img_src = response.images[0].url;
					let link = response.external_urls.spotify;
					let artist_name = response.name;

					$('#featured-artists').append('<li class="featured"><img src="' + img_src + '" alt="'+ artist_name +'"><a href="'+ link +'" target="_blank" ><h3>'+ artist_name +'</h3></a></li>');
				}
			});
		}

		console.log(user);
		console.log(genres);
		console.log(final_genres);
		console.log(playlist);
		console.log(artists);
		console.log(playlist_artists);
	</script>
</html>

<!-- 

THINGS LEFT TO DO
x collect tracks
- create playlist
- add tracks to playlist


BUGS
- it hangs if all_genres is less than 5
 -->