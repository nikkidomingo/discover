<html>
	<head>
		<title>Discover</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="home.css">
	</head>
	<body>

		<h1>Discover</h1>
		<p>Explore new music.</p>
		
		<p>Add an artist's name to generate a playlist of tracks from related artist. You can add up to <b>5</b> artists.</p>
		
		<div class="input-container">
			<input id="input-artist" class="input-text" type="text">
			<button id="btn-add" class="btn btn-pink">&#10010;</button>
		</div>
		
		<div class="artists-container">
			<ul id="artists-list">
			</ul>
		</div>

		<button class="btn btn-blue">Create Playlist</button>

	</body>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script>
		
		var user = {};

		function getHashParams() {
	        var hashParams = {};
	        var e, r = /([^&;=]+)=?([^&;]*)/g,
	            q = window.location.hash.substring(1);
	        	while ( e = r.exec(q)) {
	        		hashParams[e[1]] = decodeURIComponent(e[2]);
	        	}
	        return hashParams;
	    }

	    var params = getHashParams();

	    var access_token = params.access_token,
	        state = params.state;

	    if (!access_token) {
          	alert('There was an error during the authentication');
        } else {
            $.ajax({
                url: 'https://api.spotify.com/v1/me',
                headers: {
                  	'Authorization': 'Bearer ' + access_token
                },
                success: function(response) {
                	console.log('success');
                	user = response;
                	$('.user').append("Hello, " + user.display_name + "." );
                }
            });
      	}

      	// Add Artist to list
      	$("#btn-add").click(function() {
      		var artist = $('#input-artist').val();
      		console.log(artist);
      		$.ajax({
      			url: 'https://api.spotify.com/v1/search?q='+ artist +'&type=artist',
      			headers: {
      				'Authorization': 'Bearer ' + access_token
      			},
      			success: function(response){
      				console.log(response);
      				var artist_items = response.artists.items;
      				if (artist_items.length == 0) {
      					alert('Sorry! There’s no artist with that name. Make sure to enter the artist’s exact name.');
      				} else {
      					for (i in artist_items) {
							let artist_name = artist_items[i].name;
      						if (artist_name.toUpperCase() == artist.toUpperCase()){
      							console.log(i);
      							$('#artists-list').append('<li class="artist">'+ artist_name +' <a class="btn-delete">&#10006;</a></li>');
      							break;
      						}
      					}
      				}
      				$('#input-artist').val("");
      			}
      		});
      	});

      	// Remove Artist from list
		$('#artists-list').on('click', '.btn-delete', function() {
			$(this).closest('li').remove();
		});

	</script>
</html>